{% extends "arca/base2.html" %}

{% block page-tible %}REGISTRO DE NEGOCIO{% endblock %}
{% block breadcrumb %}
<li><a href="{% url 'arca_index' %}">Inicio</a></li>
<li class="active">Registro de negocio</li>
{% endblock %}
{% block main-content %}
<div id="form-div">
    {% csrf_token %}
    <div class="row">
      <div class="col-xs-12">
          <div id="alert-messages"></div>
      </div>
    </div>
    <div class="row" id="paso1">
        <div class="col-xs-12 stepsWrapper">
          <div class="innerWrapper clearfix stepsPage">
            <div class="row progress-wizard" style="border-bottom:0;">

              <div class="col-xs-3 progress-wizard-step complete">
                <div class="text-center progress-wizard-stepnum">General</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="#" class="progress-wizard-dot"></a>
              </div>

              <div class="col-xs-3 progress-wizard-step disabled">
                <div class="text-center progress-wizard-stepnum">Detalles</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="javascript:cambiarPaso(2,1)" class="progress-wizard-dot"></a>
              </div>

              <div class="col-xs-3 progress-wizard-step disabled">
                <div class="text-center progress-wizard-stepnum">Autenticación</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="javascript:cambiarPaso(3,1)" class="progress-wizard-dot"></a>
              </div>

              <div class="col-xs-3 progress-wizard-step disabled">
                <div class="text-center progress-wizard-stepnum">Confirmacion</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="javascript:cambiarPaso(4,1)" class="progress-wizard-dot"></a>
              </div>
            </div>


              <div class="col-xs-12">
                <div class="page-header">
                  <h4>Como se llama tu Empresa?</h4>
                </div>
              </div>
              <div class="form-group col-xs-12">
                <label for="">Nombre de mi empresa</label>
                <input class="form-control" id="nombre_empresa" name="nombre_empresa" type="text" required="required">
              </div>
              <div class="form-group col-xs-12">
                  <label for="">Categoria</label>
                  <select class="form-control" id="categoria_empresa" name="categoria_empresa">
                    <option selected disabled value="0">--SELECCIONE UNA CATEGORIA--</option>
                      {% for categoria in categorias %}
                          <option value="{{ categoria.id }}">{{ categoria.nombre }}</option>
                      {% endfor %}
                  </select>
              </div>
              <div class="col-xs-12">
                <div class="well well-lg clearfix">
                  <ul class="pager">
                    <li class="previous"><a href="#" class="hideContent">back</a></li>
                    <li class="next"><a href="javascript:cambiarPaso(2,1)">Continue</a></li>
                  </ul>
                </div>
              </div>

          </div>
        </div>
    </div>
    <div class="row" id="paso2">
        <div class="col-xs-12 stepsWrapper">
          <div class="innerWrapper clearfix stepsPage">
            <div class="row progress-wizard" style="border-bottom:0;">

              <div class="col-xs-3 progress-wizard-step complete fullBar">
                <div class="text-center progress-wizard-stepnum">General</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="javascript:cambiarPaso(1,2)" class="progress-wizard-dot"></a>
              </div>

              <div class="col-xs-3 progress-wizard-step active">
                <div class="text-center progress-wizard-stepnum">Detalles</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="#" class="progress-wizard-dot"></a>
              </div>

              <div class="col-xs-3 progress-wizard-step disabled">
                <div class="text-center progress-wizard-stepnum">Autenticación</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="javascript:cambiarPaso(3,2)" class="progress-wizard-dot"></a>
              </div>

              <div class="col-xs-3 progress-wizard-step disabled">
                <div class="text-center progress-wizard-stepnum">Confirmacion</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="javascript:cambiarPaso(4,2)" class="progress-wizard-dot"></a>
              </div>

            </div>


              <div class="col-xs-12">
                <div class="page-header">
                  <h4>Dinos mas acerca de ella</h4>
                </div>
              </div>
              <div class="form-group col-sm-6 col-xs-12">
                <label for="">RUC/NIT</label>
                <input class="form-control" id="identificacion" name="identificacion" required
                       type="text">
              </div>
              <div class="form-group col-sm-6 col-xs-12">
                <label for="">Telefono</label>
                <input class="form-control" id="telefono" name="telefono" required
                    type="text">
              </div>
              <div class="form-group col-xs-12">
                <label for="">Dirección</label>
                <input class="form-control" id="direccion" name="direccion" required
                    type="text">
              </div>
              <div class="col-xs-12">
                <div class="well well-lg clearfix">
                  <ul class="pager">
                    <li class="previous"><a href="javascript:cambiarPaso(1,2)">Regresar</a></li>
                    <li class="next"><a href="javascript:cambiarPaso(3,2)">Continuar</a></li>
                  </ul>
                </div>
              </div>

          </div>
        </div>
    </div>
    <div class="row" id="paso3">
        <div class="col-xs-12 stepsWrapper">
          <div class="innerWrapper clearfix stepsPage">
            <div class="row progress-wizard" style="border-bottom:0;">

              <div class="col-xs-3 progress-wizard-step complete fullBar">
                <div class="text-center progress-wizard-stepnum">General</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="javascript:cambiarPaso(1,3)" class="progress-wizard-dot"></a>
              </div>

              <div class="col-xs-3 progress-wizard-step complete fullBar">
                <div class="text-center progress-wizard-stepnum">Detalles</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="javascript:cambiarPaso(2,3)" class="progress-wizard-dot"></a>
              </div>

              <div class="col-xs-3 progress-wizard-step active">
                <div class="text-center progress-wizard-stepnum">Autenticación</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="#" class="progress-wizard-dot"></a>
              </div>

              <div class="col-xs-3 progress-wizard-step disabled">
                <div class="text-center progress-wizard-stepnum">Confirmacion</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="javascript:cambiarPaso(4,3)" class="progress-wizard-dot"></a>
              </div>

            </div>

              <div class="col-xs-12">
                <div class="page-header">
                  <h4>Tus datos para que puedas ingresar..</h4>
                </div>
              </div>
              <div class="form-group col-sm-6 col-xs-12">
                <label for="">Nombre</label>
                <input class="form-control" id="usuario_nombre" name="usuario_nombre" type="text" required="required">
              </div>
              <div class="form-group col-sm-6 col-xs-12">
                <label for="">Apellido</label>
                <input class="form-control" id="usuario_apellido" name="usuario_apellido" type="text" required="required">
              </div>
              <div class="form-group col-sm-12 col-xs-12">
                <label for="">Correo Electronico</label>
                <input class="form-control" id="email" name="email" type="text" required="required">
              </div>
              <div class="form-group col-sm-6 col-xs-12">
                <label for="">Contraseña</label>
                <input class="form-control" id="password" name="password" type="password" required="required">
              </div>
              <div class="form-group col-sm-6 col-xs-12">
                <label for="">Contraseña Confirmacion</label>
                <input class="form-control" id="password_conf" name="password_conf" type="password" required="required">
              </div>

              <div class="col-xs-12">
                <div class="well well-lg clearfix">
                  <ul class="pager">
                    <li class="previous"><a href="javascript:cambiarPaso(2,3)" >Regresar</a></li>
                    <li class="next"><a  href="javascript:cambiarPaso(4,3)">Continuar</a></li>
                      <button id="submmitbutton" type="submit" class="hide"></button>
                  </ul>
                </div>
              </div>
          </div>
        </div>
    </div>
    <div class="row" id="paso4">
        <div class="col-xs-12 stepsWrapper">
          <div class="innerWrapper clearfix stepsPage">
            <div class="row progress-wizard" style="border-bottom:0;">

              <div class="col-xs-3 progress-wizard-step complete fullBar">
                <div class="text-center progress-wizard-stepnum">General</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="javascript:cambiarPaso(1,4)" class="progress-wizard-dot"></a>
              </div>

              <div class="col-xs-3 progress-wizard-step complete fullBar">
                <div class="text-center progress-wizard-stepnum">Detalles</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="javascript:cambiarPaso(2,4)" class="progress-wizard-dot"></a>
              </div>

              <div class="col-xs-3 progress-wizard-step complete fullBar">
                <div class="text-center progress-wizard-stepnum">Autenticación</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="javascript:cambiarPaso(3,4)" class="progress-wizard-dot"></a>
              </div>

              <div class="col-xs-3 progress-wizard-step active">
                <div class="text-center progress-wizard-stepnum">Confirmacion</div>
                <div class="progress"><div class="progress-bar"></div></div>
                <a href="#" class="progress-wizard-dot"></a>
              </div>

            </div>

              <div class="col-xs-12">
                <div class="page-header">
                  <h4>Estan bien esto datos?</h4>
                </div>
              </div>
              <div class="col-sm-6 col-xs-12">
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <h4 class="panel-title">Datos de la empresa</h4>
                  </div>
                  <div class="panel-body">
                    <address>
                      <strong style="font-weight: bold !important;">Nombre</strong><br>
                      <span id="lbl_nombre_empresa"></span><br>
                      <strong style="font-weight: bold !important;">Categoria</strong><br>
                      <span id="lbl_categoria_empresa"></span><br>
                      <strong style="font-weight: bold !important;">Identificacion</strong><br>
                      <span id="lbl_identificacion_empresa"></span><br>
                      <strong style="font-weight: bold !important;">Dirección</strong><br>
                      <span id="lbl_direccion_empresa"></span><br>
                      <strong style="font-weight: bold !important;">Teléfono</strong><br>
                      +505 <span id="lbl_telefono_empresa"></span><br>
                    </address>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-xs-12">
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <h4 class="panel-title">Datos para el imgreso</h4>
                  </div>
                  <div class="panel-body">
                    <address>
                      <strong style="font-weight: bold !important;">Nombre</strong><br>
                      <span id="lbl_nombre_usuario"></span><br>
                      <strong style="font-weight: bold !important;">Email</strong><br>
                      <span id="lbl_email_usuario"></span><br>
                    </address>
                  </div>
                </div>
              </div>
              <div class="col-xs-12">
                <div class="well well-lg clearfix">
                  <ul class="pager">
                    <li class="previous"><a href="javascript:cambiarPaso(3,4)" >Regresar</a></li>
                    <li class="next"><a href="javascript:guardarComercio()">Completar</a></li>
                  </ul>
                </div>
              </div>

          </div>
        </div>
    </div>
</div>
{% endblock %}
{% block script-block %}
    <script>
        $(document).ready(function () {
            $("#paso1").addClass( "hide" );
            $("#paso2").addClass( "hide" );
            $("#paso3").addClass( "hide" );
            $("#paso4").addClass( "hide" );
            cambiarPaso(1,0);
        });
        function cambiarPaso(paso, paso_actual) {
             $("#alert-messages").html("");
             var todo_ok=false;
             if(paso<paso_actual){ //SI SE DIRIGE A UN PASO ANTERIOR SE OMITE VALIDACION
                 todo_ok=true;
             }else{
                 switch (paso_actual){
                     case 0:
                         todo_ok=true;
                         break;
                     case 1:
                         var nombre_empresa = $("#nombre_empresa").val();
                         var categoria_empresa= parseInt($("#categoria_empresa option:selected" ).val());
                         if(nombre_empresa.length<2){
                             $("#nombre_empresa").focus();
                             mostrar_alerta("Nombre de empresa requerido");
                         }else if(categoria_empresa==0){
                             $("#categoria_empresa").focus();
                             mostrar_alerta("Categoria de empresa requerida");
                         }else
                            todo_ok=true;
                         break;
                     case 2:
                         var identificacion = $("#identificacion").val();
                         var telefono = $("#telefono").val();
                         var direccion = $("#direccion").val();
                         if(identificacion.length<2){
                             $("#identificacion").focus();
                             mostrar_alerta("Identificacion de empresa requerida");
                         }else  if(telefono.length<2){
                             $("#telefono").focus();
                             mostrar_alerta("Telefono de empresa requerido");
                         }else  if(direccion.length<2){
                             $("#direccion").focus();
                             mostrar_alerta("Direccion de empresa requerida");
                         }else
                            todo_ok=true;
                         break;
                     case 3:
                         var usuario_nombre = $("#usuario_nombre").val();
                         var usuario_apellido = $("#usuario_apellido").val();
                         var email = $("#email").val();
                         var password = $("#password").val();
                         var password_conf = $("#password_conf").val();
                         if(usuario_nombre.length<2){
                             $("#usuario_nombre").focus();
                             mostrar_alerta("Nombre del propietario requerida");
                         }else  if(usuario_apellido.length<2){
                             $("#usuario_apellido").focus();
                             mostrar_alerta("Apellido del propietario requerido");
                         }else  if(email.length<2){
                             $("#email").focus();
                             mostrar_alerta("Direccion de correo electronica requerida");
                         }else  if(password.length<2){
                             $("#password").focus();
                             mostrar_alerta("Contraseña requerida");
                         }else  if(password_conf.length<2){
                             $("#password_conf").focus();
                             mostrar_alerta("Confirmacion de contraseña requerida");
                         }else  if(password_conf!==password){
                             $("#password").focus();
                             mostrar_alerta("Contraseña y confirmacion no coinciden");
                         }else
                            todo_ok=true;
                         break;
                     case 4:
                         todo_ok=true;
                         break;
                 }
             }
             if(paso==4){
                 $("#lbl_nombre_empresa").html($("#nombre_empresa").val());
                 $("#lbl_categoria_empresa").html($("#categoria_empresa option:selected" ).text());
                 $("#lbl_identificacion_empresa").html($("#identificacion").val());
                 $("#lbl_telefono_empresa").html($("#telefono").val());
                 $("#lbl_direccion_empresa").html($("#direccion").val());
                 $("#lbl_nombre_usuario").html($("#usuario_nombre").val() + " " + $("#usuario_apellido").val());
                 $("#lbl_email_usuario").html($("#email").val());
             }
             if(todo_ok){
                 $("#paso"+paso).removeClass( "hide" );
                 $("#paso"+paso_actual).addClass( "hide" );
             }
        }
        function guardarComercio() {
            var data = $('#form-div :input').serialize();
            $.ajax({
                url: "{% url 'registrar_negocio_st1' %}",
                type: "post",
                data: data,
                xhrFields: { withCredentials: true },
                success: function (result) {
                    if (result.code === 200) {
                        window.location.href="{% url 'mi_comercio' %}"
                    } else {
                        cambiarPaso(result.paso,4)
                        mostrar_alerta(result.mensaje);
                        swal({
                            title: "Upss.. ha ocurrido un inconveniente",
                            text: result.mensaje,
                            type: "warning"
                        });
                    }
                }
            });
        }
        function mostrar_alerta(mensaje) {
            $("#alert-messages").html(
                '<div class="alert alert-danger fade in alert-dismissable">' +
                    '<a href="#" class="close" data-dismiss="alert" aria-label="close" title="close">×</a>'+
                    mensaje+
                '</div>');
        }
    </script>
{% endblock script-block %}